local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local WorkspaceCodex = workspace:FindFirstChild("Codex") or Instance.new("Folder", workspace)
WorkspaceCodex.Name = "Codex"

local photosFolder = WorkspaceCodex:FindFirstChild("Photos") or Instance.new("Folder", WorkspaceCodex)
photosFolder.Name = "Photos"

-- Botão principal
local mainButtonGui = Instance.new("ScreenGui", playerGui)
mainButtonGui.Name = "MainButtonGui"

local toggleButton = Instance.new("TextButton", mainButtonGui)
toggleButton.Size = UDim2.new(0,50,0,50)
toggleButton.Position = UDim2.new(1,-60,0.5,-25)
toggleButton.AnchorPoint = Vector2.new(1,0.5)
toggleButton.BackgroundColor3 = Color3.fromRGB(40,40,40)
toggleButton.Text = ">"
toggleButton.TextColor3 = Color3.fromRGB(255,255,255)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextScaled = true
toggleButton.AutoButtonColor = true

local toggleCorner = Instance.new("UICorner", toggleButton)
toggleCorner.CornerRadius = UDim.new(0,10)

-- GUI principal da galeria
local galleryGui = Instance.new("ScreenGui", playerGui)
galleryGui.Name = "GalleryGui"
galleryGui.Enabled = false

local galleryFrame = Instance.new("Frame", galleryGui)
galleryFrame.Size = UDim2.new(0,400,0,500)
galleryFrame.Position = UDim2.new(1,-420,0.5,-250)
galleryFrame.AnchorPoint = Vector2.new(0,0.5)
galleryFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
galleryFrame.BorderSizePixel = 0

local frameCorner = Instance.new("UICorner", galleryFrame)
frameCorner.CornerRadius = UDim.new(0,15)

local scrollFrame = Instance.new("ScrollingFrame", galleryFrame)
scrollFrame.Size = UDim2.new(1,-20,1,-20)
scrollFrame.Position = UDim2.new(0,10,0,10)
scrollFrame.BackgroundTransparency = 1
scrollFrame.ScrollBarThickness = 8

local uiList = Instance.new("UIListLayout", scrollFrame)
uiList.Padding = UDim.new(0,10)
uiList.SortOrder = Enum.SortOrder.LayoutOrder

local currentImageIndex = 1
local expandedFrame = Instance.new("Frame", galleryGui)
expandedFrame.Size = UDim2.new(0,600,0,400)
expandedFrame.Position = UDim2.new(0.5, -300,0.5, -200)
expandedFrame.BackgroundColor3 = Color3.fromRGB(35,35,35)
expandedFrame.Visible = false
expandedFrame.AnchorPoint = Vector2.new(0.5,0.5)
local expandedUICorner = Instance.new("UICorner", expandedFrame)
expandedUICorner.CornerRadius = UDim.new(0,20)

local expandedImage = Instance.new("ImageLabel", expandedFrame)
expandedImage.Size = UDim2.new(1, -20, 1, -20)
expandedImage.Position = UDim2.new(0,10,0,10)
expandedImage.BackgroundTransparency = 1
expandedImage.ScaleType = Enum.ScaleType.Fit

local closeButton = Instance.new("TextButton", expandedFrame)
closeButton.Text = "X"
closeButton.Size = UDim2.new(0,30,0,30)
closeButton.Position = UDim2.new(1, -40,0,10)
closeButton.BackgroundColor3 = Color3.fromRGB(200,50,50)
local closeCorner = Instance.new("UICorner", closeButton)
closeCorner.CornerRadius = UDim.new(0,10)

local nextButton = Instance.new("ImageButton", expandedFrame)
nextButton.Size = UDim2.new(0,50,0,50)
nextButton.Position = UDim2.new(1,-60,0.5,-25)
nextButton.BackgroundTransparency = 1
nextButton.Image = "rbxassetid://153287089"

local prevButton = Instance.new("ImageButton", expandedFrame)
prevButton.Size = UDim2.new(0,50,0,50)
prevButton.Position = UDim2.new(0,10,0.5,-25)
prevButton.BackgroundTransparency = 1
prevButton.Image = "rbxassetid://153287192"

-- Função para atualizar a galeria
local function updateGallery()
    for _, child in pairs(scrollFrame:GetChildren()) do
        if child:IsA("ImageButton") then
            child:Destroy()
        end
    end
    local photos = photosFolder:GetChildren()
    for i, photo in ipairs(photos) do
        if photo:IsA("ImageLabel") or photo:IsA("ImageButton") then
            local imgButton = Instance.new("ImageButton", scrollFrame)
            imgButton.Size = UDim2.new(0,100,0,100)
            imgButton.Image = photo.Image
            imgButton.BackgroundColor3 = Color3.fromRGB(70,70,70)
            local corner = Instance.new("UICorner", imgButton)
            corner.CornerRadius = UDim.new(0,10)
            imgButton.MouseButton1Click:Connect(function()
                expandedImage.Image = imgButton.Image
                expandedFrame.Visible = true
                currentImageIndex = i
            end)
        end
    end
    scrollFrame.CanvasSize = UDim2.new(0,0,0, uiList.AbsoluteContentSize.Y)
end

updateGallery()

-- Toggle botão para abrir/fechar GUI
toggleButton.MouseButton1Click:Connect(function()
    galleryGui.Enabled = not galleryGui.Enabled
    if galleryGui.Enabled then
        toggleButton.Text = "<"
    else
        toggleButton.Text = ">"
        expandedFrame.Visible = false
    end
end)

-- Fechar imagem expandida
closeButton.MouseButton1Click:Connect(function()
    expandedFrame.Visible = false
end)

-- Navegação entre imagens
local function showNext()
    local photos = photosFolder:GetChildren()
    currentImageIndex = currentImageIndex + 1
    if currentImageIndex > #photos then
        currentImageIndex = 1
    end
    expandedImage.Image = photos[currentImageIndex].Image
end

local function showPrev()
    local photos = photosFolder:GetChildren()
    currentImageIndex = currentImageIndex - 1
    if currentImageIndex < 1 then
        currentImageIndex = #photos
    end
    expandedImage.Image = photos[currentImageIndex].Image
end

nextButton.MouseButton1Click:Connect(showNext)
prevButton.MouseButton1Click:Connect(showPrev)
