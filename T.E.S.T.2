local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local cam = workspace.CurrentCamera

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "HealthAndStaminaGUI"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Parent = screenGui
mainFrame.AnchorPoint = Vector2.new(0, 0.5)
mainFrame.Position = UDim2.new(0.015, 0, 0.5, 0)
mainFrame.Size = UDim2.new(0, 220, 0, 82)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BackgroundTransparency = 0.4
mainFrame.BorderSizePixel = 0

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 14)
corner.Parent = mainFrame

local heart = Instance.new("ImageLabel")
heart.Parent = mainFrame
heart.BackgroundTransparency = 1
heart.Position = UDim2.new(0, 8, 0, 8)
heart.Size = UDim2.new(0, 32, 0, 32)
heart.Image = "rbxassetid://129352925579546"

local healthBack = Instance.new("Frame")
healthBack.Parent = mainFrame
healthBack.Position = UDim2.new(0, 48, 0, 16)
healthBack.Size = UDim2.new(0, 160, 0, 18)
healthBack.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
healthBack.BorderSizePixel = 0

local hbc = Instance.new("UICorner")
hbc.CornerRadius = UDim.new(0, 9)
hbc.Parent = healthBack

local healthFill = Instance.new("Frame")
healthFill.Parent = healthBack
healthFill.Size = UDim2.new(1, 0, 1, 0)
healthFill.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
healthFill.BorderSizePixel = 0

local hfc = Instance.new("UICorner")
hfc.CornerRadius = UDim.new(0, 9)
hfc.Parent = healthFill

local healthText = Instance.new("TextLabel")
healthText.Parent = healthBack
healthText.BackgroundTransparency = 1
healthText.Size = UDim2.new(1, 0, 1, 0)
healthText.Text = "100%"
healthText.TextColor3 = Color3.fromRGB(0, 255, 0)
healthText.TextScaled = true
healthText.Font = Enum.Font.GothamBold
healthText.TextStrokeColor3 = Color3.new(0, 0, 0)
healthText.TextStrokeTransparency = 0

local staminaIcon = Instance.new("ImageLabel")
staminaIcon.Parent = mainFrame
staminaIcon.BackgroundTransparency = 1
staminaIcon.Position = UDim2.new(0, 8, 0, 48)
staminaIcon.Size = UDim2.new(0, 24, 0, 24)
staminaIcon.Image = "rbxassetid://18909062370"

local staminaBack = Instance.new("Frame")
staminaBack.Parent = mainFrame
staminaBack.Position = UDim2.new(0, 48, 0, 52)
staminaBack.Size = UDim2.new(0, 160, 0, 18)
staminaBack.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
staminaBack.BorderSizePixel = 0

local sbc = Instance.new("UICorner")
sbc.CornerRadius = UDim.new(0, 9)
sbc.Parent = staminaBack

local staminaFill = Instance.new("Frame")
staminaFill.Parent = staminaBack
staminaFill.Size = UDim2.new(1, 0, 1, 0)
staminaFill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
staminaFill.BorderSizePixel = 0

local sfc = Instance.new("UICorner")
sfc.CornerRadius = UDim.new(0, 9)
sfc.Parent = staminaFill

local sprintBtn = Instance.new("ImageButton")
sprintBtn.Parent = screenGui
sprintBtn.BackgroundTransparency = 1
sprintBtn.Image = "rbxassetid://111292680671790"
sprintBtn.Size = UDim2.new(0, 80, 0, 80)
sprintBtn.AnchorPoint = Vector2.new(0.5, 1)

local walkSpeed = 5
local sprintSpeed = 25
local maxStamina = 100
local stamina = maxStamina
local sprinting = false
local exhausted = false
local currentSpeed = walkSpeed

local function hookCharacter(char)
	local hum = char:WaitForChild("Humanoid")

	local function updateHealth()
		local r = math.clamp(hum.Health / hum.MaxHealth, 0, 1)
		healthFill.Size = UDim2.new(r, 0, 1, 0)
		healthText.Text = math.floor(r * 100) .. "%"
	end

	hum.HealthChanged:Connect(updateHealth)
	updateHealth()
end

if player.Character then
	hookCharacter(player.Character)
end

player.CharacterAdded:Connect(hookCharacter)

sprintBtn.MouseButton1Click:Connect(function()
	if stamina > 0 and not exhausted then
		sprinting = not sprinting
	end
end)

RunService.RenderStepped:Connect(function()
	local tg = player.PlayerGui:FindFirstChild("TouchGui")
	if tg then
		local tcf = tg:FindFirstChild("TouchControlFrame")
		if tcf then
			local jump = tcf:FindFirstChild("JumpButton")
			if jump then
				jump.BackgroundTransparency = 0.75
				sprintBtn.Size = jump.Size * 1.15
				local p = jump.AbsolutePosition
				local s = jump.AbsoluteSize
				sprintBtn.Position = UDim2.new(0, p.X + s.X / 2, 0, p.Y - s.Y + 60)
			end
		end
	end
end)

RunService.RenderStepped:Connect(function(dt)
	local char = player.Character
	if not char then return end
	local hum = char:FindFirstChildOfClass("Humanoid")
	if not hum then return end

	local moving = hum.MoveDirection.Magnitude > 0.1
	local target = (sprinting and stamina > 0 and moving and not exhausted) and sprintSpeed or walkSpeed

	if currentSpeed < target then
		currentSpeed = math.min(currentSpeed + 40 * dt, target)
	else
		currentSpeed = math.max(currentSpeed - 30 * dt, target)
	end

	hum.WalkSpeed = currentSpeed

	if sprinting and moving and stamina > 0 then
		stamina = math.max(0, stamina - 20 * dt)
	else
		stamina = math.min(maxStamina, stamina + 20 * dt)
	end

	if stamina <= 0 then
		exhausted = true
		sprinting = false
	elseif stamina >= maxStamina * 0.5 then
		exhausted = false
	end

	staminaFill.Size = UDim2.new(stamina / maxStamina, 0, 1, 0)
end)

cam.FieldOfView = 70
