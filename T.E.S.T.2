local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local cam = workspace.CurrentCamera

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "HealthAndStaminaGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local FONT = Font.new("rbxassetid://12187360881")

local mainFrame = Instance.new("Frame")
mainFrame.Parent = screenGui
mainFrame.AnchorPoint = Vector2.new(0, 0.5)
mainFrame.Position = UDim2.new(0.015, 0, 0.5, 0)
mainFrame.Size = UDim2.new(0, 220, 0, 92)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BackgroundTransparency = 0.4
mainFrame.BorderSizePixel = 0

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 14)
corner.Parent = mainFrame

local heart = Instance.new("ImageLabel")
heart.Parent = mainFrame
heart.BackgroundTransparency = 1
heart.Position = UDim2.new(0, 8, 0, 10)
heart.Size = UDim2.new(0, 32, 0, 32)
heart.Image = "rbxassetid://129352925579546"

local healthBack = Instance.new("Frame")
healthBack.Parent = mainFrame
healthBack.Position = UDim2.new(0, 48, 0, 18)
healthBack.Size = UDim2.new(0, 160, 0, 18)
healthBack.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
healthBack.BorderSizePixel = 0

local healthBackCorner = Instance.new("UICorner")
healthBackCorner.CornerRadius = UDim.new(0, 9)
healthBackCorner.Parent = healthBack

local healthFill = Instance.new("Frame")
healthFill.Parent = healthBack
healthFill.Size = UDim2.new(1, 0, 1, 0)
healthFill.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
healthFill.BorderSizePixel = 0

local healthFillCorner = Instance.new("UICorner")
healthFillCorner.CornerRadius = UDim.new(0, 9)
healthFillCorner.Parent = healthFill

local healthText = Instance.new("TextLabel")
healthText.Parent = healthBack
healthText.BackgroundTransparency = 1
healthText.Size = UDim2.new(1, 0, 1, 0)
healthText.Text = "100%"
healthText.TextColor3 = Color3.fromRGB(0, 255, 0)
healthText.TextScaled = true
healthText.FontFace = FONT
healthText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
healthText.TextStrokeTransparency = 0

local staminaIcon = Instance.new("ImageLabel")
staminaIcon.Parent = mainFrame
staminaIcon.BackgroundTransparency = 1
staminaIcon.Position = UDim2.new(0, 8, 0, 52)
staminaIcon.Size = UDim2.new(0, 24, 0, 24)
staminaIcon.Image = "rbxassetid://18909062370"

local staminaBack = Instance.new("Frame")
staminaBack.Parent = mainFrame
staminaBack.Position = UDim2.new(0, 48, 0, 56)
staminaBack.Size = UDim2.new(0, 160, 0, 18)
staminaBack.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
staminaBack.BorderSizePixel = 0

local staminaBackCorner = Instance.new("UICorner")
staminaBackCorner.CornerRadius = UDim.new(0, 9)
staminaBackCorner.Parent = staminaBack

local staminaFill = Instance.new("Frame")
staminaFill.Parent = staminaBack
staminaFill.Size = UDim2.new(1, 0, 1, 0)
staminaFill.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
staminaFill.BorderSizePixel = 0

local staminaFillCorner = Instance.new("UICorner")
staminaFillCorner.CornerRadius = UDim.new(0, 9)
staminaFillCorner.Parent = staminaFill

local sprintBtn = Instance.new("ImageButton")
sprintBtn.Name = "SprintButton"
sprintBtn.AnchorPoint = Vector2.new(0.5, 1)
sprintBtn.BackgroundTransparency = 1
sprintBtn.Image = "rbxassetid://111292680671790"
sprintBtn.Parent = screenGui

local walkSpeed = 16
local sprintSpeed = 32
local accelRate = 20
local decelRate = 15
local maxStamina = 300
local staminaDrainRate = 20
local staminaRegenRate = 45
local fovSprint = 70
local fovNormal = 70
local fovExhausted = 70

local stamina = maxStamina
local sprinting = false
local isExhausted = false
local currentWalkSpeed = walkSpeed

local function hookCharacter(character)
	local humanoid = character:WaitForChild("Humanoid")

	local function updateHealth()
		local ratio = math.clamp(humanoid.Health / humanoid.MaxHealth, 0, 1)
		healthFill.Size = UDim2.new(ratio, 0, 1, 0)
		healthText.Text = math.floor(ratio * 100) .. "%"

		if humanoid.Health <= 0 then
			healthText.Text = "DEAD"
			healthText.TextColor3 = Color3.fromRGB(255, 0, 0)
			healthFill.BackgroundColor3 = Color3.fromRGB(120, 0, 0)
			heart.Image = "rbxassetid://89748414415617"
		elseif ratio < 0.5 then
			healthText.TextColor3 = Color3.fromRGB(255, 60, 60)
			healthFill.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
			heart.Image = "rbxassetid://89748414415617"
		else
			healthText.TextColor3 = Color3.fromRGB(0, 255, 0)
			healthFill.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
			heart.Image = "rbxassetid://94877796283249"
		end
	end

	humanoid.HealthChanged:Connect(updateHealth)
	updateHealth()
end

if player.Character then
	hookCharacter(player.Character)
end

player.CharacterAdded:Connect(hookCharacter)

sprintBtn.MouseButton1Click:Connect(function()
	if stamina > 0 and not isExhausted then
		sprinting = not sprinting
	end
end)

RunService.RenderStepped:Connect(function()
	local touchGui = player.PlayerGui:FindFirstChild("TouchGui")
	if not touchGui then return end

	local controlFrame = touchGui:FindFirstChild("TouchControlFrame")
	if not controlFrame then return end

	local jumpBtn = controlFrame:FindFirstChild("JumpButton")
	if jumpBtn then
		jumpBtn.BackgroundTransparency = 1
		sprintBtn.Size = UDim2.new(
			jumpBtn.Size.X.Scale,
			jumpBtn.Size.X.Offset + 6,
			jumpBtn.Size.Y.Scale,
			jumpBtn.Size.Y.Offset + 6
		)

		local pos = jumpBtn.AbsolutePosition
		local size = jumpBtn.AbsoluteSize
		sprintBtn.Position = UDim2.new(
			0,
			pos.X + size.X / 2,
			0,
			pos.Y - size.Y + 60
		)
	end
end)

RunService.RenderStepped:Connect(function(dt)
	local character = player.Character
	if not character then return end
	local humanoid = character:FindFirstChildOfClass("Humanoid")
	if not humanoid then return end

	local isMoving = humanoid.MoveDirection.Magnitude > 0.1
	local targetSpeed = (sprinting and stamina > 0 and isMoving and not isExhausted) and sprintSpeed or walkSpeed
	local rate = (currentWalkSpeed < targetSpeed) and accelRate or decelRate

	if currentWalkSpeed < targetSpeed then
		currentWalkSpeed = math.min(currentWalkSpeed + rate * dt, targetSpeed)
	elseif currentWalkSpeed > targetSpeed then
		currentWalkSpeed = math.max(currentWalkSpeed - rate * dt, targetSpeed)
	end

	humanoid.WalkSpeed = currentWalkSpeed

	if sprinting and stamina > 0 and isMoving and not isExhausted then
		stamina = math.max(0, stamina - staminaDrainRate * dt)
	else
		stamina = math.min(maxStamina, stamina + staminaRegenRate * dt)
	end

	if stamina <= 0 then
		isExhausted = true
		sprinting = false
	elseif stamina >= maxStamina * 0.5 then
		isExhausted = false
	end

	staminaFill.Size = UDim2.new(stamina / maxStamina, 0, 1, 0)

	if isExhausted then
		cam.FieldOfView = fovExhausted
	elseif sprinting then
		cam.FieldOfView = fovSprint
	else
		cam.FieldOfView = fovNormal
	end
end)

cam.FieldOfView = fovNormal
