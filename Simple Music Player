local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

local gui = Instance.new("ScreenGui")
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local floatingGui = Instance.new("Frame")
floatingGui.Size = UDim2.fromOffset(90,90)
floatingGui.BackgroundTransparency = 1
floatingGui.Parent = gui

local ball = Instance.new("Frame")
ball.Size = UDim2.fromScale(1,1)
ball.BackgroundColor3 = Color3.fromRGB(255,0,0)
ball.Parent = floatingGui
Instance.new("UICorner",ball).CornerRadius = UDim.new(1,0)

local ring = Instance.new("UIStroke")
ring.Thickness = 6
ring.Color = Color3.fromRGB(255,0,0)
ring.Parent = ball

local click = Instance.new("TextButton")
click.Size = UDim2.fromScale(1,1)
click.BackgroundTransparency = 1
click.Text = ""
click.Parent = ball

local playerGui = Instance.new("ScreenGui")
playerGui.ResetOnSpawn = false
playerGui.Enabled = false
playerGui.Parent = player.PlayerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.fromScale(0.5,0.55)
frame.Position = UDim2.fromScale(0.5,0.5)
frame.AnchorPoint = Vector2.new(0.5,0.5)
frame.BackgroundColor3 = Color3.fromRGB(18,18,18)
frame.Parent = playerGui
Instance.new("UICorner",frame).CornerRadius = UDim.new(0,26)

local close = Instance.new("TextButton")
close.Text = "❌"
close.Size = UDim2.fromScale(0.1,0.1)
close.Position = UDim2.fromScale(0.88,0.02)
close.BackgroundTransparency = 1
close.TextScaled = true
close.Parent = frame
close.MouseButton1Click:Connect(function()
	playerGui.Enabled = false
end)

local box = Instance.new("TextBox")
box.PlaceholderText = "Music ID"
box.Size = UDim2.fromScale(0.9,0.12)
box.Position = UDim2.fromScale(0.05,0.15)
box.BackgroundColor3 = Color3.fromRGB(30,30,30)
box.TextColor3 = Color3.new(1,1,1)
box.ClearTextOnFocus = false
box.Parent = frame
Instance.new("UICorner",box).CornerRadius = UDim.new(0,16)

local function btn(text,pos)
	local b = Instance.new("TextButton")
	b.Text = text
	b.Size = UDim2.fromScale(0.4,0.14)
	b.Position = pos
	b.BackgroundColor3 = Color3.fromRGB(40,40,40)
	b.TextScaled = true
	b.Parent = frame
	Instance.new("UICorner",b)
	return b
end

local play = btn("▶️",UDim2.fromScale(0.05,0.32))
local pause = btn("⏸️",UDim2.fromScale(0.55,0.32))
local back = btn("⏪",UDim2.fromScale(0.05,0.62))
local forward = btn("⏩",UDim2.fromScale(0.55,0.62))

local barBg = Instance.new("Frame")
barBg.Size = UDim2.fromScale(0.9,0.06)
barBg.Position = UDim2.fromScale(0.05,0.52)
barBg.BackgroundColor3 = Color3.fromRGB(45,45,45)
barBg.Parent = frame
Instance.new("UICorner",barBg)

local barFill = Instance.new("Frame")
barFill.Size = UDim2.fromScale(0,1)
barFill.Parent = barBg
Instance.new("UICorner",barFill)

local credits = Instance.new("TextLabel")
credits.Text = "Made by Hydra"
credits.Size = UDim2.fromScale(1,0.1)
credits.Position = UDim2.fromScale(0,0.85)
credits.BackgroundTransparency = 1
credits.TextScaled = true
credits.TextColor3 = Color3.fromRGB(160,160,160)
credits.Parent = frame

local sound = Instance.new("Sound")
sound.Volume = 2
sound.PlaybackSpeed = 1
sound.Parent = playerGui

local currentId
play.MouseButton1Click:Connect(function()
	local id = tonumber(box.Text)
	if id and id ~= currentId then
		currentId = id
		sound.SoundId = "rbxassetid://"..id
		sound:Play()
	elseif not sound.IsPlaying then
		sound:Resume()
	end
end)

pause.MouseButton1Click:Connect(function()
	if sound.IsPlaying then sound:Pause() end
end)

forward.MouseButton1Click:Connect(function()
	if sound.TimeLength > 0 then
		sound.TimePosition = math.clamp(sound.TimePosition+10,0,sound.TimeLength)
	end
end)

back.MouseButton1Click:Connect(function()
	if sound.TimeLength > 0 then
		sound.TimePosition = math.clamp(sound.TimePosition-10,0,sound.TimeLength)
	end
end)

click.MouseButton1Click:Connect(function()
	playerGui.Enabled = true
end)

local hue = 0
RunService.RenderStepped:Connect(function(dt)
	hue = (hue + dt*0.6) % 1
	local color = Color3.fromHSV(hue,1,1)
	ball.BackgroundColor3 = color
	ring.Color = color
	barFill.BackgroundColor3 = color

	local char = player.Character
	if not char then return end
	local head = char:FindFirstChild("Head")
	if not head then return end

	local worldPos = head.Position + Vector3.new(0,2,0)
	local screenPos, onScreen = camera:WorldToViewportPoint(worldPos)
	if onScreen then
		floatingGui.Position = UDim2.fromOffset(screenPos.X-45,screenPos.Y-45)
	end
end)
