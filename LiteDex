local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Importação dos ícones via Lucide (IDs atualizados conforme o RAW)
local Icons = {
	Workspace = "rbxassetid://10734898475",
	Players = "rbxassetid://10747373176",
	Folder = "rbxassetid://10734774348",
	Model = "rbxassetid://10734949056",
	Script = "rbxassetid://10734943604",
	Default = "rbxassetid://10747362105",
	ChevronDown = "rbxassetid://10709790934",
	ChevronRight = "rbxassetid://10709791523",
	Delete = "rbxassetid://10709819149",
	Copy = "rbxassetid://10709804257",
	Paste = "rbxassetid://10709804163"
}

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "LiteDexMobile"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Frame Principal (Tamanho Mobile)
local Main = Instance.new("Frame")
Main.Size = UDim2.fromScale(0.8, 0.6) -- Ocupa 80% da largura, 60% da altura
Main.Position = UDim2.fromScale(0.5, 0.5)
Main.AnchorPoint = Vector2.new(0.5, 0.5)
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Main.BorderSizePixel = 0
Main.ClipsDescendants = true
Main.Parent = ScreenGui
Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 12)

-- Animação de Entrada
Main.GroupTransparency = 1
TweenService:Create(Main, TweenInfo.new(0.5, Enum.EasingStyle.Quart), {Size = UDim2.fromScale(0.85, 0.65)}):Play()

-- TopBar
local TopBar = Instance.new("Frame")
TopBar.Size = UDim2.new(1, 0, 0, 45)
TopBar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TopBar.Parent = Main

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -20, 1, 0)
Title.Position = UDim2.fromOffset(15, 0)
Title.BackgroundTransparency = 1
Title.Text = "Lite Dex Mobile"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TopBar

-- Lista de Itens (Corrigida para Mobile)
local Body = Instance.new("ScrollingFrame")
Body.Size = UDim2.new(1, -10, 1, -55)
Body.Position = UDim2.fromOffset(5, 50)
Body.BackgroundTransparency = 1
Body.ScrollBarThickness = 3
Body.CanvasSize = UDim2.new(0, 0, 0, 0)
Body.Parent = Main

local Layout = Instance.new("UIListLayout", Body)
Layout.Padding = UDim.new(0, 4) -- Mais espaço para não clicar errado
Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
	Body.CanvasSize = UDim2.new(0, 0, 0, Layout.AbsoluteContentSize.Y + 20)
end)

-- Menu de Contexto (Adaptado para Touch)
local Context = Instance.new("Frame")
Context.Size = UDim2.fromOffset(160, 120)
Context.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Context.Visible = false
Context.ZIndex = 100
Context.Parent = ScreenGui
Instance.new("UICorner", Context).CornerRadius = UDim.new(0, 8)

local function CtxButton(text, icon, y)
	local b = Instance.new("TextButton")
	b.Size = UDim2.new(1, -10, 0, 35) -- Botão mais alto para dedo
	b.Position = UDim2.new(0, 5, 0, y + 5)
	b.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
	b.Text = text
	b.Font = Enum.Font.GothamMedium
	b.TextSize = 14
	b.TextColor3 = Color3.fromRGB(255, 255, 255)
	b.TextXAlignment = Enum.TextXAlignment.Left
	b.Parent = Context
	Instance.new("UICorner", b).CornerRadius = UDim.new(0, 6)
	
	local i = Instance.new("ImageLabel")
	i.Size = UDim2.fromOffset(20, 20)
	i.Position = UDim2.fromOffset(10, 7.5)
	i.BackgroundTransparency = 1
	i.Image = icon
	i.Parent = b
	
	Instance.new("UIPadding", b).PaddingLeft = UDim.new(0, 40)
	return b
end

local BtnDelete = CtxButton("Apagar", Icons.Delete, 0)
local BtnCopy = CtxButton("Copiar", Icons.Copy, 38)
local BtnPaste = CtxButton("Colar", Icons.Paste, 76)

-- Lógica de Ícones
local function GetIcon(inst)
	if inst == workspace then return Icons.Workspace end
	if inst:IsA("Player") then return Icons.Players end
	if inst:IsA("Folder") then return Icons.Folder end
	if inst:IsA("Model") then return Icons.Model end
	if inst:IsA("LuaSourceContainer") then return Icons.Script end
	return Icons.Default
end

local function CreateItem(inst, depth)
	local Row = Instance.new("Frame")
	Row.Size = UDim2.new(1, 0, 0, 32)
	Row.BackgroundTransparency = 1
	Row.Parent = Body

	local Arrow = Instance.new("ImageButton")
	Arrow.Size = UDim2.fromOffset(20, 20) -- Aumentado para Mobile
	Arrow.Position = UDim2.fromOffset(depth * 20 + 5, 6)
	Arrow.BackgroundTransparency = 1
	Arrow.Image = (#inst:GetChildren() > 0) and Icons.ChevronRight or ""
	Arrow.Parent = Row

	local Icon = Instance.new("ImageLabel")
	Icon.Size = UDim2.fromOffset(20, 20)
	Icon.Position = UDim2.fromOffset(depth * 20 + 30, 6)
	Icon.BackgroundTransparency = 1
	Icon.Image = GetIcon(inst)
	Icon.Parent = Row

	local Button = Instance.new("TextButton")
	Button.Size = UDim2.new(1, -(depth * 20 + 60), 1, 0)
	Button.Position = UDim2.fromOffset(depth * 20 + 55, 0)
	Button.BackgroundTransparency = 1
	Button.Text = inst.Name
	Button.Font = Enum.Font.Gotham
	Button.TextSize = 14
	Button.TextColor3 = Color3.fromRGB(230, 230, 230)
	Button.TextXAlignment = Enum.TextXAlignment.Left
	Button.Parent = Row

	-- Animação de Clique (Feedback visual)
	Button.MouseButton1Click:Connect(function()
		local tween = TweenService:Create(Row, TweenInfo.new(0.2), {BackgroundTransparency = 0.8, BackgroundColor3 = Color3.fromRGB(255,255,255)})
		tween:Play()
		tween.Completed:Connect(function() Row.BackgroundTransparency = 1 end)
	end)

	-- Clique longo para Menu (Mobile friendly)
	local connection
	Button.MouseButton1Down:Connect(function()
		local holding = true
		task.delay(0.6, function()
			if holding then
				Context.Position = UDim2.fromOffset(UserInputService:GetMouseLocation().X, UserInputService:GetMouseLocation().Y - 40)
				Context.Visible = true
				if connection then connection:Disconnect() end
				connection = BtnDelete.MouseButton1Click:Connect(function()
					pcall(function() inst:Destroy() end)
					Row:Destroy()
					Context.Visible = false
				end)
			end
		end)
		UserInputService.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then holding = false end
		end)
	end)

	local expanded = false
	local childrenRows = {}

	local function Toggle()
		expanded = not expanded
		Arrow.Image = expanded and Icons.ChevronDown or Icons.ChevronRight
		if expanded then
			for _, child in ipairs(inst:GetChildren()) do
				local sub = CreateItem(child, depth + 1)
				table.insert(childrenRows, sub)
			end
		else
			for _, r in ipairs(childrenRows) do r:Destroy() end
			childrenRows = {}
		end
	end

	Arrow.MouseButton1Click:Connect(Toggle)
	return Row
end

-- Iniciar Explorer
local Roots = {workspace, Players, game:GetService("ReplicatedStorage")}
for _, v in ipairs(Roots) do
	pcall(function() CreateItem(v, 0) end)
end

-- Fechar menu ao tocar fora
UserInputService.InputBegan:Connect(function(i)
	if i.UserInputType == Enum.UserInputType.MouseButton1 and Context.Visible then
		Context.Visible = false
	end
end)
